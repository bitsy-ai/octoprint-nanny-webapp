{% extends "account/base.html" %}

{% load static i18n %}

{% block head_title %}{% trans "Get Access to" %}{% endblock head_title %}
{% load crispy_forms_tags %}

{% block body_extra %}
class="loading authentication-bg" data-layout-config='{"leftSideBarTheme":"dark","layoutBoxed":false, "leftSidebarCondensed":false, "leftSidebarScrollable":false,"darkMode":false, "showRightSidebarOnStart": true}'
{% endblock body_extra %}

{% block page_content %}

<div class="account-pages mt-5 mb-5">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-4">
                <div class="card">
                    <!-- Logo-->
                    <div class="card-header pt-4 pb-4 text-center bg-primary text-white">
                        <h1><img src="{% static 'images/logo-square/square-color-no-text-180-by-180.png' %}" alt="Print Nanny logo" height="80">
                            Get Early Access</h1>
                    </div>

                    <div class="card-body p-4">
                        
                        <div class="text-center w-75 m-auto">
                            <p class="text-dark-50 text-center mt-0 font-weight-bold">{% trans "<strong>Founding Members</strong> enjoy unlimited access." %}</p> 

                            <h3 class="text-dark-50 text-center mt-0 font-weight-bold">{{ AVAILABLE_SUBSCRIPTIONS_COUNT }} Memberships Remaining </h3>

                            <p class="text-muted mb-4">{% trans "Create your account to get started." %} </p>

                        </div>
                    
                    </div> <!-- end card-body -->
                    <div class="col-12 text-center">
                        <p class="text-muted">{% trans "Already have account?" %} <a href="{{ login_url }}" class="text-muted ml-1"><b>{% trans "Log In" %}</b></a></p>
                    </div> <!-- end col-->
                </div>
                <!-- end card -->
            </div> <!-- end col -->

            <div class="col-lg-4">
                {% include 'subscriptions/founding-member-cards.html' %}
            </div> <!-- end col -->
        </div>
        <!-- end row -->
    </div>
    <!-- end container -->
</div>
<!-- end page -->
<footer class="bg-dark py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <img src="{% static 'images/logo-text-white.svg' %}" alt="" class="logo-dark" height="18" />
                <p class="text-white-50 mt-4">Print Nanny was created by Leigh Johnson. Read more about her at <a href="https://www.bitsy.ai/about/">bitsy.ai</a>.</p>

                <ul class="social-list list-inline mt-3">
                    <li class="list-inline-item text-center">
                        <a target="_blank" href="https://twitter.com/grepLeigh" class="social-list-item border-info text-info"><i class="uil uil-twitter"></i></a>
                    </li>
                    <li class="list-inline-item text-center">
                        <a  target="_blank"href="https://medium.com/@grepLeigh" class="social-list-item border-secondary text-secondary"><i class="uil uil-medium-m"></i></a>
                    </li>
                    <li class="list-inline-item text-center">
                        <a  target="_blank" href="https://github.com/bitsy-ai" class="social-list-item border-secondary text-secondary"><i class="uil uil-github"></i></a>
                    </li>
                </ul>

            </div>


            <div class="col-lg-2 mt-3 mt-lg-0">
                <h5 class="text-white">Features</h5>

                <ul class="list-unstyled pl-0 mb-0 mt-3">
                    <li class="mt-2"><a href="#live-monitoring" class="text-white-50">Live Monitoring</a></li>
                    <li class="mt-2"><a href="#remote-management" class="text-white-50">Remote Management</a></li>
                    <li class="mt-2"><a href="#automation" class="text-white-50">Automation</a></li>
                    <li class="mt-2"><a href="#faq" class="text-white-50">FAQ</a></li>
                    <li class="mt-2"><a href="https://help.print-nanny.com/" class="text-white-50">Help</a></li>
                </ul>
            </div>

        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="mt-5">
                    <p a href="https://www.bitsy.ai/about/" class="text-white-50 mt-4 text-center mb-0">Â© 2021 Print Nanny, Bitsy AI Labs </p>
                </div>
            </div>
        </div>
    </div>
</footer> <!-- end footer -->
<!-- Source based on https://medium.com/@berat703/django-stripe-integration-with-using-dj-stripe-1df59d17fa73 -->
<script>
    function getCookie(name) {
        if (!document.cookie) {
            return null;
        }
        const xsrfCookies = document.cookie.split(';')
            .map(c => c.trim())
            .filter(c => c.startsWith(name + '='));
        if (xsrfCookies.length === 0) {
            return null;
        }
        return decodeURIComponent(xsrfCookies[0].split('=')[1]);
    }

    function paySubscription(price_id) {
        var devices = $("input:checkbox[name=devices]:checked").map(function() { return $(this).val() }).get();
        var displayError = $("#card-errors");
        displayError.text("");
        displayError.hide();

        if (devices.length === 0) {
            displayError.text("Please select at least one device");
            displayError.show();
            return
        }

        fetch("{% url 'subscriptions:payment_intent' %}", {
            method: 'POST',
            headers: {
                "X-CSRFToken": getCookie("csrftoken"),
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Requested-With": "XMLHttpRequest"
            },
            body: JSON.stringify({ price_id, devices })
        }).then(function (result) {
            result.json().then(function (json) {
                // Something went wrong with a message too
                if (typeof json.err !== "undefined") {
                    displayError.text(json.err);
                    displayError.show();
                }

                // Something went wrong - HTTP status code
                if (!result.ok) return

                const stripe = Stripe('{{ STRIPE_PUBLIC_KEY }}');
                stripe.redirectToCheckout({
                    sessionId: json.session_id
                }).then(function(result) {
                    // If `redirectToCheckout` fails due to a browser or network
                    // error, display the localized error message to your customer
                    // using `result.error.message`.
                    displayError.text(result.error.message);
                    displayError.show();
                });
            })
        });
    }
</script>
{% endblock page_content %}

