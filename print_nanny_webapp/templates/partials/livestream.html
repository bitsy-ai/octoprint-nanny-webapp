{% load static %}

<div class="row">
      <div class="col-sm-12 col-md-6">
          <div class="card">
            <div class="card-body">
                <h2 class="header-title">Livestream</h2>
      
                <div id="stream-loading">
                  <p>Your web camera stream is either buffering or offline.</p>
                  <img src="{% static 'images/loading.svg' %}" class="img-responsive" />
      
                </div>
                {% if object.printerprofile_set.count == 0 %}
                  <p class="text-muted font-14">OctoPrint Disconnected</p>
                  <p>Hey! Your OctoPrint installation wasn't found.</p>
                  <!-- <p>Is this your first time using Print Nanny? Follow these this guide to get setup: </p> -->
      
                {% else %}
                {% endif %}
                <img id="stream" class="img-responsive">
            </div>
          </div>
        </div>
  </div>
<script>
    const loading = document.querySelector('#stream-loading');
  
    const video = document.querySelector('#stream');
    
    const WS_URL = "{{ WS_BASE_URL }}/video/";
    const ws = new WebSocket(WS_URL);
  
    ws.onmessage = (msg) => {
      console.log(msg)
      video.src = "data:image/png;base64," + msg.data
      loading.style.display = 'none';
    }
    ws.onopen = () => {
      console.log(`Connected to ${WS_URL}`);
    }
</script>